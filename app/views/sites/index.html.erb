<script>
$(document).ready(function() {
	initialize();
});
</script>

<h1>San Francisco's Premier Lost and Found Resource</h1>
<div class="row">
	<div class="col-md-12">
		<div class="row">
			<div id="map-div">
			</div>
		</div>
		<div class="row">
			<div class="col-md-8">

				<% @posts.each do |post| %> 
				<div class="well">
					<h4><%= post.status %></h4>
					<p><a href="/posts/<%= post.id %>"><%= post.title %></a></p>

					<p><%= post.description %></p>
				</div>
				<% end %>

			</div>
			<div class="col-md-4">
				<div class="well sign-up">
					<p>Sharing is easy as 1-2-3</p>
					<p><span>1</span>Lorem Ipsum</p>
					<p><span>2</span>Lorem Ipsum</p>
					<p><span>2</span>Lorem Ipsum</p>
				</div>
			</div>
		</div>
	</div>
</div>

<script type="text/javascript">

function initialize() {
	
	var mapOptions = {
		center: new google.maps.LatLng(37.783333, -122.416667),
		zoom: 13,
		mapTypeId: google.maps.MapTypeId.ROADMAP
	}; // end mapOptions

	var map = new google.maps.Map(document.getElementById('map-div'), mapOptions);

	google.maps.event.addDomListener(window, 'load', initialize);

	var geocoder = new google.maps.Geocoder();

	var addresses =
	   	$.get('/posts.json').
	   	done(function (data) {
	   		console.log("DATA", data);
	   		var addressArray = [];
	   		var titleArray = [];
			// loop through data and get locations
			for(var i = 0; i < data.length; i++) {
				addressArray.push(data[i].location);
				titleArray.push(data[i].title);	
			}
			console.log(addressArray);
			console.log(titleArray);

			$.each(addressArray, function(index, address1) {
				console.log(index + ": " + address1);
	   			geocoder.geocode({
	      			'address': address1 + " San Francisco, CA"
	   			}, 
	   			function(results, status) {
	      			if(status == google.maps.GeocoderStatus.OK) {
	      				console.log(results);
	         			new google.maps.Marker({
		            		position: results[0].geometry.location,
		            		map: map
	         			});
	         //map.setCenter(results[0].geometry.location);
	     	 		} // end if
	   			}); // end function
			}); // end each
	   	}); // end done

}//end initialize

</script>
